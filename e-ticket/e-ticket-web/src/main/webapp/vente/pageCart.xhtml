<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/resources/tpl/pageCorpsTemplate.xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:etsmtl="http://java.sun.com/jsf/composite/etsmtl"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core">


    <ui:define name="content">
        <h:form id="formPanier" > <br/>

            <p:panel id="panelPanierCompte" header="Votre panier: #{panierCtrl.count}, ATTENTION ! (Selon le nombre de billet par représentation)"  rendered="true" toggleable="true" >       
                <div style="overflow: auto">
                    <p:dataTable id="tableVar" var="item" value="#{panierCtrl.cacheSessionPresentation.representationSelected}" widgetVar="LaTable" paginator="true" rows="5"
                                 emptyMessage="Veuille sélectionner des représentations" rowKey="#{item}"
                                 editable="true" selectionMode="single"
                                 paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                 rowsPerPageTemplate="5,10,15,25" >                  

                        <f:facet name="header" >          
                            <table border="0" >
                                <tr style="border-style: hidden;">
                                    <td align="left" width="125px" style="white-space: nowrap;">Les representation sélectionnés</td>
                                    <td style="border-style: hidden;" align="left" width="20px" ><p:ajaxStatus style="width:16px;height:16px;" id="ajaxStatusPanel" > <f:facet name="start"><h:graphicImage value="/resources/etsmtl/img/ajaxLoader1.gif" alt="Patientez Pendant le chargement....." /> </f:facet> <f:facet name="complete"> <h:outputText value="" /> </f:facet> </p:ajaxStatus></td>
                                    <td align="right"><h:outputText value=" Recherche Globale " /><p:inputText id="globalFilter" onkeyup="LaTable.filter()" size="23" /> <p:watermark for="globalFilter" value="Mots clés..." /></td>
                                </tr>
                            </table>
                        </f:facet>

                        <!--<composite:insertChildren id="colonneTableCrud" />-->
                        <p:column headerText="Artiste" filterBy="#{panierCtrl.cacheSessionPresentation.spectacleSelected.artiste.nom}" sortBy="#{panierCtrl.cacheSessionPresentation.spectacleSelected.artiste.lienPhoto}" >
                            <h:outputLabel value="#{panierCtrl.cacheSessionPresentation.spectacleSelected.artiste.nom}"  />
                        </p:column>

                        <p:column headerText="Quantity"  >
                            <h:outputLabel value="#{item.QTE}"  /> 
                        </p:column>

                        <p:column headerText="Show" filterBy="#{panierCtrl.cacheSessionPresentation.spectacleSelected.nomSpectacle}" sortBy="#{panierCtrl.cacheSessionPresentation.spectacle.nomSpectacle}" >
                            <h:outputLabel value="#{panierCtrl.cacheSessionPresentation.spectacleSelected.nomSpectacle}"  />  
                        </p:column>

                        <p:column headerText="Town" filterBy="#{item.salle.adresse}" sortBy="#{item.salle.adresse}" >
                            <h:outputLabel value="#{item.salle.adresse}"  />  
                        </p:column>

                        <p:column headerText="Date" filterBy="#{item.dateDebut}" sortBy="#{item.dateDebut}" >
                            <etsmtl:outputCalendar valeur="#{item.dateDebut}" />  
                        </p:column>

                        <p:column headerText="Hour" filterBy="#{item.dateDebut.hours}:#{item.dateDebut.minutes}" sortBy="#{item.dateDebut.hours}:#{item.dateDebut.minutes}" >
                            <h:outputLabel value="#{item.dateDebut.hours}:#{item.dateDebut.minutes}" />  
                        </p:column> 

                        <p:column headerText="Détails" style="width: 40px;" >                                            
                            <p:commandButton id="actionOnDetails" disabled="false" global="false" update=":formPanier:mydialog:documentPanel" immediate="true" oncomplete="documentDialog.show()" actionListener="#{panierCtrl.onDetailsEnregistrement(item)}" title="Afficher Détails" icon="ui-icon-zoomin" />
                        </p:column>
                        <p:column headerText="Supprimer" style="width: 40px;" >                                            
                            <p:commandButton id="actionOnBillets" disabled="false" global="false" update=":formPanier:tableVar" immediate="true"  actionListener="#{panierCtrl.supprimerRep(item)}" title="Supprimer Billet(s)" icon="ui-icon-circle-close" />
                        </p:column> 

                        <f:facet name="footer"> 
                            <p:button outcome="pageCheckout" value="BUY" icon="ui-icon-suitcase" ></p:button> <p:spacer width="40px"/>
                            <p:commandButton value="Ajouter au Panier ( #{panierCtrl.count} )" actionListener="#{panierCtrl.increment}" disabled="#{cacheSessionPresentationCtrl.disablePanier}" update="@this :formPanier:panelPanierCompte" icon="ui-icon-cart" /> <p:spacer width="40px"/> 
                            <p:button type="reset" value="CANCEL" icon="ui-icon-cancel" ></p:button>                   
                        </f:facet>

                    </p:dataTable>
                </div>

                <etsmtl:dialogDetails id="mydialog" >

                </etsmtl:dialogDetails>


                <p:blockUI block="tableVar" trigger="tableVar">  
                    LOADING<br />  
                    <p:graphicImage value="/resources/etsmtl/img/ajaxLoader5.gif"/>  
                </p:blockUI>             
            </p:panel>


        </h:form>

    </ui:define>


</ui:composition>
